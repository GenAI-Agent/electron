# ğŸš€ æ–°åŠŸèƒ½èªªæ˜æ–‡æª”

## ğŸ“‹ åŠŸèƒ½æ¦‚è¦½

æœ¬æ¬¡æ›´æ–°æ·»åŠ äº†ä¸‰å€‹ä¸»è¦åŠŸèƒ½ï¼š

1. **Frontend åˆ·æ–° Session åŠŸèƒ½** - å·¦ä¸Šè§’åˆ·æ–°æŒ‰éˆ•
2. **Task Memory ç³»çµ±** - æ”¯æŒæ‰¹æ¬¡è™•ç†å’Œå¾ªç’°ä»»å‹™
3. **ç¹ªåœ–å¯è¦–åŒ–ç³»çµ±** - å®Œæ•´çš„åœ–è¡¨å‰µå»ºå’Œé¡¯ç¤ºåŠŸèƒ½

---

## 1. ğŸ”„ Frontend åˆ·æ–° Session åŠŸèƒ½

### åŠŸèƒ½æè¿°
åœ¨ Agent Panel å·¦ä¸Šè§’æ·»åŠ äº†åˆ·æ–°æŒ‰éˆ•ï¼Œå¯ä»¥å‰µå»ºæ–°çš„ session ä¸¦æ¸…ç©ºç•¶å‰å°è©±è¨˜éŒ„ã€‚

### ä½¿ç”¨æ–¹æ³•
- é»æ“Š Agent Panel å·¦ä¸Šè§’çš„ ğŸ”„ åˆ·æ–°æŒ‰éˆ•
- ç³»çµ±æœƒè‡ªå‹•å‰µå»ºæ–°çš„ session ID
- æ¸…ç©ºç•¶å‰çš„å°è©±è¨˜éŒ„å’Œç‹€æ…‹

### æŠ€è¡“å¯¦ç¾
- ä½¿ç”¨ `sessionManager.createNewSession()` å‰µå»ºæ–°æœƒè©±
- æ¸…ç©º `messages`ã€`streamResponse`ã€`currentRule`ã€`usedTools` ç­‰ç‹€æ…‹
- ä¿æŒ session éš”é›¢ï¼Œç¢ºä¿æ•¸æ“šä¸æœƒæ··æ·†

---

## 2. ğŸ§  Task Memory ç³»çµ±

### åŠŸèƒ½æè¿°
å®Œæ•´çš„ä»»å‹™è¨˜æ†¶ç®¡ç†ç³»çµ±ï¼Œæ”¯æŒï¼š
- æ‰¹æ¬¡è™•ç†ä»»å‹™ï¼ˆå¯è™•ç†1000+ç­†è³‡æ–™ï¼‰
- å¾ªç’°ä»»å‹™åŸ·è¡Œ
- ä¸­é–“çµæœä¿å­˜åˆ° tmp ç©ºé–“
- ä»»å‹™é€²åº¦è¿½è¹¤å’Œæ¢å¾©
- Tool result ç´¯ç©

### æ ¸å¿ƒçµ„ä»¶

#### TaskMemoryManager
- `create_batch_task()`: å‰µå»ºæ‰¹æ¬¡è™•ç†ä»»å‹™
- `process_batch_task()`: åŸ·è¡Œæ‰¹æ¬¡è™•ç†
- `get_task_status()`: ç²å–ä»»å‹™ç‹€æ…‹
- `pause_task()` / `resume_task()`: æš«åœ/æ¢å¾©ä»»å‹™

#### SessionStorage
- `save_temp_data()`: ä¿å­˜æš«å­˜æ•¸æ“šåˆ° tmp ç©ºé–“
- `load_temp_data()`: è¼‰å…¥æš«å­˜æ•¸æ“š
- æ”¯æŒæœƒè©±ç´šåˆ¥çš„æ•¸æ“šéš”é›¢

#### å¯ç”¨å·¥å…·
- `create_batch_task_tool`: å‰µå»ºæ‰¹æ¬¡ä»»å‹™
- `get_task_status_tool`: æŸ¥è©¢ä»»å‹™ç‹€æ…‹
- `save_temp_data_tool`: ä¿å­˜æš«å­˜æ•¸æ“š
- `load_temp_data_tool`: è¼‰å…¥æš«å­˜æ•¸æ“š
- `list_session_tasks_tool`: åˆ—å‡ºæœƒè©±ä»»å‹™
- `pause_task_tool` / `resume_task_tool`: æš«åœ/æ¢å¾©ä»»å‹™
- `generate_task_report_tool`: ç”Ÿæˆä»»å‹™å ±å‘Š

### ä½¿ç”¨ç¯„ä¾‹

```python
# å‰µå»ºæ‰¹æ¬¡ä»»å‹™è™•ç†1000ç­†è³‡æ–™
await create_batch_task_tool(
    session_id="my_session",
    task_id="process_1000_items", 
    items=data_list,  # 1000ç­†è³‡æ–™
    batch_size=50     # æ¯æ‰¹è™•ç†50ç­†
)

# ä¿å­˜ä¸­é–“çµæœ
await save_temp_data_tool(
    session_id="my_session",
    data_id="processed_results",
    data={"results": processed_data, "count": 500}
)
```

---

## 3. ğŸ“Š ç¹ªåœ–å¯è¦–åŒ–ç³»çµ±

### åŠŸèƒ½æè¿°
å®Œæ•´çš„åœ–è¡¨å‰µå»ºå’Œé¡¯ç¤ºç³»çµ±ï¼Œæ”¯æŒï¼š
- å¤šç¨®åœ–è¡¨é¡å‹ï¼ˆç·šåœ–ã€æŸ±ç‹€åœ–ã€æ•£é»åœ–ã€åœ“é¤…åœ–ï¼‰
- åœ–è¡¨æ–‡ä»¶ç®¡ç†
- Electron ä¸­çš„åœ–è¡¨é¡¯ç¤º
- åœ–è¡¨ä¸‹è¼‰å’Œç¸®æ”¾åŠŸèƒ½

### æ”¯æŒçš„åœ–è¡¨é¡å‹

#### ç·šåœ– (Line Chart)
```python
await create_line_chart_tool(
    data=[{"x": 1, "y": 10}, {"x": 2, "y": 15}],
    x_column="x",
    y_column="y", 
    title="éŠ·å”®è¶¨å‹¢åœ–"
)
```

#### æŸ±ç‹€åœ– (Bar Chart)
```python
await create_bar_chart_tool(
    data=[{"category": "A", "value": 100}],
    x_column="category",
    y_column="value",
    title="åˆ†é¡çµ±è¨ˆåœ–"
)
```

#### æ•£é»åœ– (Scatter Plot)
```python
await create_scatter_plot_tool(
    data=[{"x": 1, "y": 10}, {"x": 2, "y": 15}],
    x_column="x", 
    y_column="y",
    title="ç›¸é—œæ€§åˆ†æåœ–"
)
```

#### åœ“é¤…åœ– (Pie Chart)
```python
await create_pie_chart_tool(
    data=[{"label": "A", "value": 30}],
    label_column="label",
    value_column="value",
    title="æ¯”ä¾‹åˆ†å¸ƒåœ–"
)
```

### Frontend åœ–è¡¨æŸ¥çœ‹å™¨

#### æ–°å¢åœ–è¡¨é¢æ¿
- åœ¨ Agent Panel å³ä¸Šè§’æ·»åŠ äº† ğŸ“Š åœ–è¡¨æŒ‰éˆ•
- é»æ“Šå¯åˆ‡æ›åˆ°åœ–è¡¨æŸ¥çœ‹æ¨¡å¼
- é¡¯ç¤ºç•¶å‰æœƒè©±çš„æ‰€æœ‰åœ–è¡¨

#### åœ–è¡¨åŠŸèƒ½
- åœ–è¡¨ç¸®ç•¥åœ–ç¶²æ ¼é¡¯ç¤º
- é»æ“Šåœ–è¡¨å¯å…¨å±é è¦½
- æ”¯æŒåœ–è¡¨ç¸®æ”¾ï¼ˆ0.5x - 3xï¼‰
- åœ–è¡¨ä¸‹è¼‰åŠŸèƒ½
- åœ–è¡¨é¡å‹æ¨™ç±¤å’Œå…ƒæ•¸æ“šé¡¯ç¤º

---

## ğŸ› ï¸ å®‰è£å’Œé…ç½®

### 1. å®‰è£ç¹ªåœ–ä¾è³´

```bash
cd backend
python install_plotting_deps.py
```

### 2. æ¸¬è©¦æ–°åŠŸèƒ½

```bash
cd backend  
python test_new_features.py
```

### 3. å•Ÿå‹•ç³»çµ±

```bash
# å¾Œç«¯
cd backend
python -m uvicorn main:app --reload

# å‰ç«¯
cd frontend
npm run dev
```

---

## ğŸ¯ ä½¿ç”¨å ´æ™¯

### å ´æ™¯1: å¤§é‡æ•¸æ“šè™•ç†
```
ç”¨æˆ¶: "å¹«æˆ‘è™•ç†é€™1000ç­†å®¢æˆ¶æ•¸æ“šï¼Œåˆ†ææ¯å€‹å®¢æˆ¶çš„è³¼è²·æ¨¡å¼"

Agentæœƒ:
1. ä½¿ç”¨ create_batch_task_tool å‰µå»ºæ‰¹æ¬¡ä»»å‹™
2. æ¯æ‰¹è™•ç†50ç­†æ•¸æ“š
3. ä½¿ç”¨ save_temp_data_tool ä¿å­˜ä¸­é–“çµæœ
4. æœ€çµ‚ç”Ÿæˆå®Œæ•´çš„åˆ†æå ±å‘Š
```

### å ´æ™¯2: æ•¸æ“šå¯è¦–åŒ–
```
ç”¨æˆ¶: "æ ¹æ“šéŠ·å”®æ•¸æ“šå‰µå»ºä¸€å€‹è¶¨å‹¢åœ–"

Agentæœƒ:
1. åˆ†ææ•¸æ“šçµæ§‹
2. ä½¿ç”¨ create_line_chart_tool å‰µå»ºç·šåœ–
3. åœ–è¡¨è‡ªå‹•ä¿å­˜åˆ°æœƒè©±ç›®éŒ„
4. ç”¨æˆ¶å¯åœ¨åœ–è¡¨é¢æ¿æŸ¥çœ‹å’Œä¸‹è¼‰
```

### å ´æ™¯3: é•·æ™‚é–“ä»»å‹™ç®¡ç†
```
ç”¨æˆ¶: "é–‹å§‹è™•ç†å¤§æ‰¹é‡æ•¸æ“šï¼Œæˆ‘éœ€è¦æš«åœä¸€ä¸‹"

Agentæœƒ:
1. ä½¿ç”¨ pause_task_tool æš«åœç•¶å‰ä»»å‹™
2. ä¿å­˜ç•¶å‰é€²åº¦åˆ° tmp ç©ºé–“
3. ç¨å¾Œä½¿ç”¨ resume_task_tool æ¢å¾©ä»»å‹™
4. å¾ä¸Šæ¬¡åœæ­¢çš„åœ°æ–¹ç¹¼çºŒè™•ç†
```

---

## ğŸ”§ æŠ€è¡“æ¶æ§‹

### Task Memory æ¶æ§‹
```
TaskMemoryManager
â”œâ”€â”€ SessionStorage (æœƒè©±å­˜å„²)
â”‚   â”œâ”€â”€ sessions/          # æœƒè©±ç›®éŒ„
â”‚   â”œâ”€â”€ global_cache/      # å…¨å±€ç·©å­˜
â”‚   â”œâ”€â”€ data_tables/       # é‡è¦è³‡æ–™è¡¨
â”‚   â””â”€â”€ batch_processing/  # æ‰¹æ¬¡è™•ç†
â””â”€â”€ ProgressTracker (é€²åº¦è¿½è¹¤)
    â”œâ”€â”€ ä»»å‹™ç‹€æ…‹ç®¡ç†
    â”œâ”€â”€ æª¢æŸ¥é»æ©Ÿåˆ¶
    â””â”€â”€ é€²åº¦æŒä¹…åŒ–
```

### ç¹ªåœ–ç³»çµ±æ¶æ§‹
```
Plotting System
â”œâ”€â”€ Backend Tools
â”‚   â”œâ”€â”€ matplotlib/seaborn åœ–è¡¨ç”Ÿæˆ
â”‚   â”œâ”€â”€ åœ–è¡¨æ–‡ä»¶ç®¡ç†
â”‚   â””â”€â”€ æœƒè©±ç´šåˆ¥åœ–è¡¨å­˜å„²
â””â”€â”€ Frontend Viewer
    â”œâ”€â”€ ChartViewer çµ„ä»¶
    â”œâ”€â”€ åœ–è¡¨ç¶²æ ¼é¡¯ç¤º
    â”œâ”€â”€ å…¨å±é è¦½åŠŸèƒ½
    â””â”€â”€ ä¸‹è¼‰å’Œç¸®æ”¾åŠŸèƒ½
```

---

## ğŸ“ æ³¨æ„äº‹é …

1. **ç¹ªåœ–ä¾è³´**: é¦–æ¬¡ä½¿ç”¨éœ€è¦å®‰è£ matplotlibã€seaborn ç­‰ä¾è³´
2. **æ–‡ä»¶æ¬Šé™**: ç¢ºä¿ tmp ç›®éŒ„æœ‰å¯«å…¥æ¬Šé™
3. **æœƒè©±éš”é›¢**: ä¸åŒæœƒè©±çš„æ•¸æ“šå’Œåœ–è¡¨æ˜¯éš”é›¢çš„
4. **å…§å­˜ç®¡ç†**: å¤§æ‰¹é‡æ•¸æ“šè™•ç†æ™‚æ³¨æ„å…§å­˜ä½¿ç”¨
5. **åœ–è¡¨æ ¼å¼**: ç›®å‰æ”¯æŒ PNG æ ¼å¼ï¼ŒDPI 300

---

## ğŸš€ æœªä¾†æ“´å±•

1. **æ›´å¤šåœ–è¡¨é¡å‹**: ç†±åŠ›åœ–ã€ç®±ç·šåœ–ã€é›·é”åœ–ç­‰
2. **äº¤äº’å¼åœ–è¡¨**: ä½¿ç”¨ Plotly å‰µå»ºäº¤äº’å¼åœ–è¡¨
3. **åœ–è¡¨æ¨¡æ¿**: é è¨­çš„åœ–è¡¨æ¨£å¼å’Œä¸»é¡Œ
4. **æ‰¹é‡åœ–è¡¨**: ä¸€æ¬¡å‰µå»ºå¤šå€‹ç›¸é—œåœ–è¡¨
5. **åœ–è¡¨å‹•ç•«**: æ”¯æŒå‹•æ…‹åœ–è¡¨å’Œæ™‚é–“åºåˆ—å‹•ç•«

---

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **ç¹ªåœ–å·¥å…·ä¸å¯ç”¨**
   - é‹è¡Œ `python install_plotting_deps.py`
   - æª¢æŸ¥ Python ç’°å¢ƒå’ŒåŒ…ç®¡ç†å™¨

2. **åœ–è¡¨ä¸é¡¯ç¤º**
   - æª¢æŸ¥æ–‡ä»¶è·¯å¾‘æ¬Šé™
   - ç¢ºèª Electron å¯ä»¥è¨ªå•è‡¨æ™‚ç›®éŒ„

3. **ä»»å‹™è¨˜æ†¶å¤±æ•ˆ**
   - æª¢æŸ¥ task_memory ç›®éŒ„æ¬Šé™
   - ç¢ºèªæœƒè©± ID æ­£ç¢º

4. **åˆ·æ–°æŒ‰éˆ•ç„¡æ•ˆ**
   - æª¢æŸ¥ sessionManager æ˜¯å¦æ­£ç¢ºåˆå§‹åŒ–
   - ç¢ºèª localStorage å¯ç”¨

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. é‹è¡Œ `python test_new_features.py` é€²è¡Œè¨ºæ–·
2. æŸ¥çœ‹å¾Œç«¯æ—¥èªŒè¼¸å‡º
3. æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°éŒ¯èª¤
4. ç¢ºèªæ‰€æœ‰ä¾è³´å·²æ­£ç¢ºå®‰è£
